# QAChatAgent 前端项目

## 项目简介

QAChatAgent 前端是一个基于 Vue 3 + Vite 构建的现代化 Web 应用，为 PDF 处理与知识库系统提供直观、美观的用户界面。该项目采用组合式 API 和最新的前端技术栈，实现了知识库管理、文档预览和智能对话等核心功能。

## 核心功能

### 知识库管理
- **知识库创建与删除**：支持创建自定义知识库和删除非默认知识库
- **知识库切换**：在不同知识库之间快速切换
- **默认知识库**：系统提供一个默认知识库，确保基础功能可用

### 文档管理
- **文件上传**：
  - 支持拖拽上传和点击上传
  - 显示上传进度和文件信息
  - 支持多种文件格式
- **文档预览**：
  - 支持 PDF、图片、Markdown 和文本文件预览
  - **PDF 原文/批注切换**：在预览界面切换原文和批注版本
  - 全屏预览模式
- **文档列表**：
  - 按上传时间倒序排列
  - 显示文件名、大小和上传时间
  - 支持文件删除操作

### 聊天界面
- **会话管理**：创建、切换和删除聊天会话
- **消息展示**：区分用户和 AI 消息，显示发送时间
- **输入区域**：支持多行输入和快捷发送
- **科技感 UI**：现代化设计，提供良好的视觉体验
- **历史对话上下文**：系统记住并理解历史对话，提供连贯的交互体验
- **流式响应**：AI回答实时流式显示，提供即时反馈
- **知识库切换**：可在不同知识库间无缝切换，满足不同场景需求

## 最近更新与修复

### 2025/9/18 新增功能

1. **流式聊天历史上下文功能**
   - 功能：聊天系统支持历史对话上下文感知，提供更连贯的交互体验
   - 实现：后端使用LangChain上下文感知检索器，优化知识库检索结果
   - 特性：
     - 自动理解并参考历史对话内容
     - 基于历史对话优化知识库检索
     - 智能重构用户问题以提高检索精度
   - 修复：解决SQLAlchemy条件比较类型问题

### 2025/9/16 新增功能

1. **PDF文件原文/批注切换功能**
   - 功能：在PDF文件预览界面添加"原文"和"批注"切换按钮
   - 实现：当预览PDF文件时，可以在原文和批注版本之间切换
   - 批注文件命名规则：与原文件同路径下的`{原文件名}_annotated.pdf`
   - 修改文件：
     - `src/components/GlobalPreview.vue`：添加切换按钮和逻辑
     - `src/views/knowledge/KnowledgeView.vue`：添加相同的切换功能

### 2025/9/15 修复内容

1. **Element Plus组件解析错误修复**
   - 问题：全局预览组件中的Element Plus组件无法被正确解析
   - 解决方案：在全局预览组件的应用实例中注册Element Plus和图标

2. **Vue Router警告修复**
   - 问题：路由配置中存在命名冲突
   - 解决方案：将路由名称从父路由移到子路由上

## 技术栈

- **核心框架**：
  - Vue 3：使用组合式API构建响应式界面
  - Vite：快速的前端构建工具

- **状态管理与路由**：
  - Pinia：Vue的状态管理库，替代Vuex
  - Vue Router：Vue的官方路由管理器

- **UI组件与样式**：
  - Element Plus：基于Vue 3的组件库
  - Sass/SCSS：CSS预处理器
  - 自定义主题：支持亮色/暗色模式

- **网络请求**：
  - Axios：基于Promise的HTTP客户端
  - SSE：用于流式聊天响应

- **数据持久化**：
  - localStorage：保存知识库和会话信息

## 项目结构

```
frontend/
├── public/              # 静态资源
├── src/
│   ├── assets/          # 项目资源文件
│   │   ├── icons/       # SVG图标
│   │   ├── element-theme.scss  # Element Plus主题配置
│   │   └── theme.css    # 全局主题变量
│   ├── components/      # 组件
│   │   ├── layout/      # 布局组件
│   │   │   └── MainLayout.vue  # 主布局组件
│   │   ├── FilePreview.vue  # 文件预览组件
│   │   ├── GlobalPreview.vue  # 全局预览组件
│   │   └── KnowledgeManagement.vue  # 知识库管理组件
│   ├── router/          # 路由配置
│   │   └── index.js     # 路由定义
│   ├── services/        # API服务
│   │   └── api.js       # API封装
│   ├── stores/          # Pinia状态管理
│   │   ├── chat.js      # 聊天状态
│   │   └── knowledge.js # 知识库状态
│   ├── views/           # 页面视图
│   │   ├── chat/        # 聊天相关视图
│   │   │   └── ChatView.vue  # 聊天页面
│   │   └── knowledge/   # 知识库相关视图
│   │       └── KnowledgeView.vue  # 知识库页面
│   ├── App.vue          # 根组件
│   ├── main.js          # 入口文件
│   └── style.css        # 全局样式
├── index.html           # HTML模板
├── package.json         # 项目依赖
├── vite.config.js       # Vite配置
└── README.md            # 前端文档
```

## UI 设计特点

### 现代化科技感界面
- **渐变色彩**：使用蓝紫色渐变增强科技感
- **微妙动画**：按钮和交互元素添加细微动画效果
- **网格背景**：聊天和知识库界面使用网格背景增强深度感
- **卡片阴影**：使用阴影效果提升界面层次感

### 响应式设计
- 适应不同设备和屏幕尺寸
- 合理的布局结构和组件排列
- 优化的移动端交互体验

### 用户体验优化
- **文件预览**：支持多种文件格式的预览
- **加载状态**：显示操作进度和加载状态
- **错误处理**：友好的错误提示和恢复机制
- **确认对话框**：重要操作需要确认，防止误操作

## 开发指南

### 安装依赖

```bash
# 使用 npm
npm install

# 或使用 yarn
yarn

# 或使用 pnpm
pnpm install
```

### 启动开发服务器

```bash
# 使用 npm
npm run dev

# 或使用 yarn
yarn dev

# 或使用 pnpm
pnpm dev
```

### 构建生产版本

```bash
# 使用 npm
npm run build

# 或使用 yarn
yarn build

# 或使用 pnpm
pnpm build
```

### 预览生产构建

```bash
# 使用 npm
npm run preview

# 或使用 yarn
yarn preview

# 或使用 pnpm
pnpm preview
```

## 数据持久化

项目使用 localStorage 进行数据持久化，保存以下信息：
- 知识库列表和详情
- 文档信息和路径
- 聊天会话和消息历史

## 性能优化

1. **懒加载**：
   - 路由组件懒加载
   - 大型组件按需加载

2. **资源优化**：
   - 图标使用 SVG 格式
   - 样式按需导入
   - 第三方库按需引入

3. **渲染优化**：
   - 虚拟滚动处理长列表
   - 使用 Vue 的 `shallowRef` 优化大型对象
   - 合理使用 `v-once` 和 `v-memo`

## 扩展与定制

1. **主题定制**：
   - 修改 `src/assets/theme.css` 中的变量
   - 调整 Element Plus 主题配置

2. **添加新组件**：
   - 在 `src/components` 目录下创建新组件
   - 遵循现有的命名和样式约定

3. **扩展功能**：
   - 在 `src/stores` 添加新的状态管理
   - 在 `src/services` 添加新的 API 服务